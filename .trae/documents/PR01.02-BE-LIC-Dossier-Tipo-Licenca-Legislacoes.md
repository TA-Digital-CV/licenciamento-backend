# PR01.02-BE-LIC - Dossier Tipo de Licença - Legislações

## 1. Visão Geral

Este documento especifica a gestão das legislações aplicáveis aos tipos de licença, incluindo a associação de leis, decretos, regulamentos e outras normas legais que regem cada tipo de licenciamento. Este módulo é essencial para garantir conformidade legal e fornecer base jurídica para os processos de licenciamento.

**Módulo:** Dossier de Tipo de Licença - Legislações  
**Endpoint Base:** `/api/v1/legislations` e `/api/v1/license-types/{id}/legislations`  
**Versão:** 1.0  
**Data:** 2024

---

## 2. Estrutura do Módulo de Legislações

### 2.1 Entidade Legislação

#### 2.1.1 Campos da Legislação
| Campo | Tipo | Validação | Descrição |
|-------|------|-----------|----------|
| id | String | Auto-gerado | Identificador único |
| title | String | 5-300 chars, NotBlank | Título da legislação |
| number | String | NotBlank, Unique | Número/código oficial |
| type | String | NotBlank, Must exist in OPTIONS | Tipo de legislação |
| publicationDate | LocalDate | NotNull, Past or Present | Data de publicação |
| effectiveDate | LocalDate | NotNull | Data de entrada em vigor |
| summary | String | Max 1000 chars | Resumo do conteúdo |
| officialUrl | String | Valid URL | Link para texto oficial |
| status | String | NotBlank | Status da legislação |
| scope | String | Must exist in OPTIONS | Âmbito de aplicação |

#### 2.1.2 Estrutura do DTO de Legislação
```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@IgrpDTO
public class LegislationRequestDTO {
    @NotNull(message = "Título é obrigatório")
    @NotBlank(message = "Título não pode estar vazio")
    @Size(min = 5, max = 300, message = "Título deve ter entre 5 e 300 caracteres")
    private String title;
    
    @NotNull(message = "Número é obrigatório")
    @NotBlank(message = "Número não pode estar vazio")
    @Size(max = 50, message = "Número não pode exceder 50 caracteres")
    private String number;
    
    @NotNull(message = "Tipo é obrigatório")
    @NotBlank(message = "Tipo não pode estar vazio")
    private String typeKey;  // Referência para OPTIONS com ccode="LEGISLATION_TYPE"
    
    @NotNull(message = "Data de publicação é obrigatória")
    @PastOrPresent(message = "Data de publicação não pode ser futura")
    private LocalDate publicationDate;
    
    @NotNull(message = "Data de vigência é obrigatória")
    private LocalDate effectiveDate;
    
    @Size(max = 1000, message = "Resumo não pode exceder 1000 caracteres")
    private String summary;
    
    @URL(message = "URL oficial deve ser válida")
    private String officialUrl;
    
    @NotNull(message = "Status é obrigatório")
    @NotBlank(message = "Status não pode estar vazio")
    private String statusKey;  // Referência para OPTIONS com ccode="LEGISLATION_STATUS"
    
    private String scopeKey;   // Referência para OPTIONS com ccode="LEGISLATION_SCOPE"
    
    private Object metadata;
}
```

### 2.2 Associação Tipo de Licença - Legislação

#### 2.2.1 Campos da Associação
| Campo | Tipo | Validação | Descrição |
|-------|------|-----------|----------|
| licenseTypeId | String | NotBlank, Must exist | ID do tipo de licença |
| legislationId | String | NotBlank, Must exist | ID da legislação |
| relevanceLevel | String | Must exist in OPTIONS | Nível de relevância |
| applicabilityType | String | Must exist in OPTIONS | Tipo de aplicabilidade |
| mandatoryCompliance | Boolean | NotNull | Se é obrigatório cumprir |
| complianceNotes | String | Max 500 chars | Notas sobre cumprimento |
| effectiveFrom | LocalDate | NotNull | Data de início da aplicação |
| effectiveTo | LocalDate | Optional | Data de fim da aplicação |

#### 2.2.2 Estrutura do DTO de Associação
```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@IgrpDTO
public class LicenseTypeLegislationRequestDTO {
    @NotNull(message = "ID da legislação é obrigatório")
    @NotBlank(message = "ID da legislação não pode estar vazio")
    private String legislationId;
    
    @NotNull(message = "Nível de relevância é obrigatório")
    @NotBlank(message = "Nível de relevância não pode estar vazio")
    private String relevanceLevelKey;  // HIGH, MEDIUM, LOW
    
    @NotNull(message = "Tipo de aplicabilidade é obrigatório")
    @NotBlank(message = "Tipo de aplicabilidade não pode estar vazio")
    private String applicabilityTypeKey;  // DIRECT, INDIRECT, REFERENCE
    
    @NotNull(message = "Campo 'cumprimento obrigatório' é obrigatório")
    private Boolean mandatoryCompliance;
    
    @Size(max = 500, message = "Notas não podem exceder 500 caracteres")
    private String complianceNotes;
    
    @NotNull(message = "Data de início é obrigatória")
    private LocalDate effectiveFrom;
    
    @Future(message = "Data de fim deve ser futura se especificada")
    private LocalDate effectiveTo;
    
    private Object metadata;
}
```

---

## 3. API REST - Gestão de Legislações

### 3.1 Operações CRUD de Legislações

#### 3.1.1 Listagem de Legislações
**Endpoint:** `GET /api/v1/legislations`

**Parâmetros de Query:**
| Parâmetro | Tipo | Obrigatório | Padrão | Descrição |
|-----------|------|-------------|--------|-----------|
| type | string | Não | - | Tipo de legislação para filtrar |
| status | string | Não | ACTIVE | Status da legislação |
| scope | string | Não | - | Âmbito de aplicação |
| publicationYear | integer | Não | - | Ano de publicação |
| effectiveFrom | date | Não | - | Data de vigência a partir de |
| title | string | Não | - | Título da legislação ou termo de busca |
| number | string | Não | - | Número oficial da legislação |
| pageNumber | string | Não | "0" | Número da página |
| pageSize | string | Não | "20" | Tamanho da página |
| sort | string | Não | "title" | Campo de ordenação |
| direction | string | Não | "ASC" | Direção da ordenação (ASC/DESC) |

**Resposta de Sucesso (200):**
```json
{
  "pageNumber": 0,
  "pageSize": 20,
  "totalElements": 85,
  "totalPages": 5,
  "content": [
    {
      "id": "leg-001",
      "title": "Lei de Licenciamento de Estabelecimentos Comerciais",
      "number": "Lei nº 15/2024",
      "typeKey": "LEI",
      "typeName": "Lei",
      "publicationDate": "2024-01-15",
      "effectiveDate": "2024-03-01",
      "summary": "Estabelece o regime jurídico do licenciamento de estabelecimentos comerciais, definindo procedimentos, requisitos e taxas aplicáveis.",
      "officialUrl": "https://bo.gov.cv/2024/lei-15-2024",
      "statusKey": "ACTIVE",
      "statusName": "Ativa",
      "scopeKey": "NATIONAL",
      "scopeName": "Nacional",
      "active": true,
      "associatedLicenseTypes": 25,
      "metadata": {
        "ministry": "Ministério do Comércio",
        "category": "Licenciamento Comercial",
        "tags": ["comercio", "licenciamento", "estabelecimentos"]
      }
    }
  ]
}
```

#### 3.1.2 Busca de Legislação por ID
**Endpoint:** `GET /api/v1/legislations/{legislationId}`

**Parâmetros de Path:**
| Parâmetro | Tipo | Descrição |
|-----------|------|-----------|
| legislationId | string | ID único da legislação |

**Resposta de Sucesso (200):**
```json
{
  "id": "leg-001",
  "title": "Lei de Licenciamento de Estabelecimentos Comerciais",
  "number": "Lei nº 15/2024",
  "type": {
    "key": "LEI",
    "name": "Lei",
    "description": "Ato normativo primário do poder legislativo"
  },
  "publicationDate": "2024-01-15",
  "effectiveDate": "2024-03-01",
  "summary": "Estabelece o regime jurídico do licenciamento de estabelecimentos comerciais, definindo procedimentos, requisitos e taxas aplicáveis.",
  "officialUrl": "https://bo.gov.cv/2024/lei-15-2024",
  "status": {
    "key": "ACTIVE",
    "name": "Ativa"
  },
  "scope": {
    "key": "NATIONAL",
    "name": "Nacional"
  },
  "active": true,
  "createdAt": "2024-01-15T10:30:00Z",
  "updatedAt": "2024-01-15T10:30:00Z",
  "metadata": {
    "ministry": "Ministério do Comércio",
    "category": "Licenciamento Comercial",
    "tags": ["comercio", "licenciamento", "estabelecimentos"]
  }
}
```

**Códigos de Status:**
- 200: Legislação encontrada
- 404: Legislação não encontrada
- 500: Erro interno do servidor

#### 3.1.3 Atualização de Legislação
**Endpoint:** `PUT /api/v1/legislations/{legislationId}`

**Parâmetros de Path:**
| Parâmetro | Tipo | Descrição |
|-----------|------|-----------|
| legislationId | string | ID único da legislação |

**Payload de Requisição:** (mesmo formato da criação)

**Códigos de Status:**
- 200: Legislação atualizada com sucesso
- 400: Dados inválidos
- 404: Legislação não encontrada
- 409: Número já existe
- 500: Erro interno do servidor

#### 3.1.4 Ativação de Legislação
**Endpoint:** `PATCH /api/v1/legislations/{legislationId}/activate`

**Parâmetros de Path:**
| Parâmetro | Tipo | Descrição |
|-----------|------|-----------|
| legislationId | string | ID único da legislação |

**Resposta de Sucesso (200):**
```json
{
  "message": "Legislação ativada com sucesso",
  "legislationId": "leg-001",
  "status": "ACTIVE"
}
```
    "key": "ACTIVE",
    "name": "Ativa",
    "description": "Legislação em vigor"
  },
  "scope": {
    "key": "NATIONAL",
    "name": "Nacional",
    "description": "Aplicável em todo o território nacional"
  },
  "relatedLegislations": [
    {
      "id": "leg-002",
      "title": "Regulamento de Licenciamento Comercial",
      "number": "Decreto-Regulamentar nº 5/2024",
      "relationship": "REGULATION"
    }
  ],
  "associatedLicenseTypes": [
    {
      "licenseTypeId": "lt-001",
      "licenseTypeName": "Licença de Restaurante",
      "relevanceLevel": "HIGH",
      "mandatoryCompliance": true
    }
  ],
  "articles": [
    {
      "number": "1º",
      "title": "Objeto e âmbito",
      "content": "A presente lei estabelece o regime jurídico...",
      "relevantFor": ["lt-001", "lt-002"]
    }
  ],
  "metadata": {
    "ministry": "Ministério do Comércio",
    "category": "Licenciamento Comercial",
    "tags": ["comercio", "licenciamento", "estabelecimentos"],
    "lastReview": "2024-01-10",
    "nextReview": "2026-01-15"
  }
}
```

#### 3.1.3 Criação de Legislação
**Endpoint:** `POST /api/v1/legislations`

**Payload de Requisição:**
```json
{
  "title": "Regulamento de Segurança Alimentar em Restaurantes",
  "number": "Portaria nº 45/2024",
  "typeKey": "PORTARIA",
  "publicationDate": "2024-02-01",
  "effectiveDate": "2024-04-01",
  "summary": "Define as normas de segurança alimentar aplicáveis a estabelecimentos de restauração",
  "officialUrl": "https://bo.gov.cv/2024/portaria-45-2024",
  "statusKey": "ACTIVE",
  "scopeKey": "NATIONAL",
  "metadata": {
    "ministry": "Ministério da Saúde",
    "category": "Segurança Alimentar",
    "tags": ["saude", "alimentar", "restauracao"],
    "relatedStandards": ["ISO 22000", "HACCP"]
  }
}
```

---

## 4. API REST - Associações Tipo de Licença - Legislação

### 4.1 Gestão de Associações

#### 4.1.1 Listar Legislações de um Tipo de Licença
**Endpoint:** `GET /api/v1/license-types/{licenseTypeId}/legislations`

**Parâmetros de Query:**
```
?relevanceLevel=HIGH
&mandatoryCompliance=true
&applicabilityType=DIRECT
&active=true
&effectiveDate=2024-01-01
```

**Resposta de Sucesso (200):**
```json
{
  "licenseTypeId": "lt-001",
  "licenseTypeName": "Licença de Restaurante",
  "totalLegislations": 8,
  "mandatoryLegislations": 5,
  "optionalLegislations": 3,
  "legislations": [
    {
      "associationId": "ltl-001",
      "legislation": {
        "id": "leg-001",
        "title": "Lei de Licenciamento de Estabelecimentos Comerciais",
        "number": "Lei nº 15/2024",
        "type": "LEI",
        "effectiveDate": "2024-03-01"
      },
      "relevanceLevel": {
        "key": "HIGH",
        "name": "Alta",
        "description": "Legislação fundamental para o tipo de licença"
      },
      "applicabilityType": {
        "key": "DIRECT",
        "name": "Direta",
        "description": "Aplica-se diretamente ao tipo de licença"
      },
      "mandatoryCompliance": true,
      "complianceNotes": "Cumprimento obrigatório para todos os estabelecimentos de restauração",
      "effectiveFrom": "2024-03-01",
      "effectiveTo": null,
      "relevantArticles": [
        {
          "article": "5º",
          "title": "Requisitos para restaurantes",
          "summary": "Define os requisitos específicos para licenciamento de restaurantes"
        }
      ]
    }
  ]
}
```

#### 4.1.2 Associar Legislação a Tipo de Licença
**Endpoint:** `POST /api/v1/license-types/{licenseTypeId}/legislations`

**Payload de Requisição:**
```json
{
  "legislationId": "leg-003",
  "relevanceLevelKey": "MEDIUM",
  "applicabilityTypeKey": "INDIRECT",
  "mandatoryCompliance": false,
  "complianceNotes": "Aplicável apenas para estabelecimentos com mais de 50 lugares",
  "effectiveFrom": "2024-06-01",
  "effectiveTo": null,
  "metadata": {
    "applicabilityConditions": {
      "minimumCapacity": 50,
      "hasAlcoholLicense": true
    },
    "complianceCheckpoints": [
      "Inspeção inicial",
      "Renovação anual"
    ]
  }
}
```

**Resposta de Sucesso (201):**
```json
{
  "associationId": "ltl-025",
  "message": "Legislação associada com sucesso",
  "licenseTypeId": "lt-001",
  "legislationId": "leg-003",
  "relevanceLevel": "MEDIUM",
  "mandatoryCompliance": false,
  "effectiveFrom": "2024-06-01"
}
```

#### 4.1.3 Atualizar Associação
**Endpoint:** `PUT /api/v1/license-types/{licenseTypeId}/legislations/{associationId}`

#### 4.1.4 Remover Associação
**Endpoint:** `DELETE /api/v1/license-types/{licenseTypeId}/legislations/{associationId}`

**Resposta de Sucesso (200):**
```json
{
  "message": "Associação removida com sucesso",
  "associationId": "ltl-025",
  "licenseTypeId": "lt-001",
  "legislationId": "leg-003",
  "removedAt": "2024-01-25T14:30:00Z",
  "impact": {
    "affectedApplications": 0,
    "pendingProcesses": 2,
    "action": "Processos pendentes continuarão com a legislação anterior"
  }
}
```

---

## 5. Funcionalidades Avançadas

### 5.1 Análise de Conformidade

#### 5.1.1 Verificação de Conformidade por Tipo
**Endpoint:** `GET /api/v1/license-types/{licenseTypeId}/compliance-analysis`

**Resposta de Sucesso (200):**
```json
{
  "licenseTypeId": "lt-001",
  "licenseTypeName": "Licença de Restaurante",
  "complianceStatus": "COMPLIANT",
  "totalLegislations": 8,
  "complianceBreakdown": {
    "mandatory": {
      "total": 5,
      "compliant": 5,
      "nonCompliant": 0,
      "pending": 0
    },
    "optional": {
      "total": 3,
      "compliant": 2,
      "nonCompliant": 0,
      "pending": 1
    }
  },
  "legislationsByRelevance": {
    "HIGH": 3,
    "MEDIUM": 3,
    "LOW": 2
  },
  "upcomingChanges": [
    {
      "legislationId": "leg-005",
      "title": "Nova Regulamentação de Horários",
      "effectiveDate": "2024-07-01",
      "impact": "MEDIUM",
      "action": "Atualização de procedimentos necessária"
    }
  ],
  "recommendations": [
    "Revisar procedimentos de segurança alimentar",
    "Atualizar documentação de conformidade"
  ]
}
```

### 5.2 Relatórios de Legislação

#### 5.2.1 Relatório de Impacto Legislativo
**Endpoint:** `GET /api/v1/legislations/{legislationId}/impact-report`

**Resposta de Sucesso (200):**
```json
{
  "legislationId": "leg-001",
  "title": "Lei de Licenciamento de Estabelecimentos Comerciais",
  "impactSummary": {
    "affectedLicenseTypes": 25,
    "totalApplications": 1250,
    "pendingApplications": 45,
    "estimatedComplianceCost": 2500000.00
  },
  "licenseTypeBreakdown": [
    {
      "licenseTypeId": "lt-001",
      "name": "Licença de Restaurante",
      "relevanceLevel": "HIGH",
      "affectedApplications": 156,
      "complianceStatus": "COMPLIANT"
    }
  ],
  "complianceTimeline": {
    "implementationDeadline": "2024-06-01",
    "gracePeriod": "2024-09-01",
    "fullEnforcement": "2024-12-01"
  },
  "requiredActions": [
    {
      "action": "Atualizar formulários de solicitação",
      "deadline": "2024-05-01",
      "responsible": "Equipe de TI"
    }
  ]
}
```

---

## 6. Regras de Negócio Específicas

### 6.1 Validações de Associação

#### 6.1.1 Regras de Integridade
- Uma legislação não pode ser associada duas vezes ao mesmo tipo de licença
- Data de início da associação não pode ser anterior à data de vigência da legislação
- Data de fim deve ser posterior à data de início
- Legislações revogadas não podem ser associadas a novos tipos

#### 6.1.2 Regras de Relevância
```java
// Validação de relevância vs obrigatoriedade
@AssertTrue(message = "Legislações de alta relevância devem ter cumprimento obrigatório")
public boolean isRelevanceComplianceValid() {
    return !"HIGH".equals(relevanceLevelKey) || Boolean.TRUE.equals(mandatoryCompliance);
}

// Validação de aplicabilidade
@AssertTrue(message = "Legislações de aplicação direta devem ter notas de cumprimento")
public boolean isDirectApplicationValid() {
    return !"DIRECT".equals(applicabilityTypeKey) || 
           (complianceNotes != null && !complianceNotes.trim().isEmpty());
}
```

### 6.2 Regras de Versionamento

#### 6.2.1 Alterações em Legislações Ativas
- Alterações em legislações associadas geram notificações automáticas
- Histórico de versões é mantido para auditoria
- Processos em andamento continuam com a versão original
- Novos processos utilizam a versão atualizada

#### 6.2.2 Revogação de Legislações
- Legislações revogadas são marcadas como inativas
- Associações existentes são mantidas para histórico
- Novas associações são bloqueadas
- Período de transição pode ser configurado

---

## 7. Casos de Uso Específicos

### 7.1 UC001 - Configurar Base Legal para Novo Tipo
**Cenário:** Criar tipo de licença para food truck

**Fluxo:**
1. Identificar legislações aplicáveis
2. Classificar por relevância e obrigatoriedade
3. Associar legislações ao tipo
4. Definir notas de cumprimento
5. Configurar datas de vigência

### 7.2 UC002 - Atualizar Legislação Existente
**Cenário:** Nova lei altera requisitos de segurança

**Fluxo:**
1. Criar nova versão da legislação
2. Identificar tipos afetados
3. Analisar impacto nas associações
4. Atualizar associações necessárias
5. Notificar stakeholders

### 7.3 UC003 - Auditoria de Conformidade
**Cenário:** Verificação periódica de conformidade

**Fluxo:**
1. Executar análise de conformidade
2. Identificar gaps e inconsistências
3. Gerar relatório de recomendações
4. Planejar ações corretivas
5. Acompanhar implementação

---

## 8. Integrações e Dependências

### 8.1 Dependências Externas
- **Sistema de Publicação Oficial**: Para URLs e textos oficiais
- **Base de Dados Jurídica**: Para validação de números e tipos
- **Sistema de Notificações**: Para alertas de mudanças

### 8.2 Integrações Internas
- **Tipos de Licença**: Associação bidirecional
- **Processos**: Verificação de conformidade
- **Solicitações**: Validação de requisitos legais
- **Relatórios**: Análise de impacto legislativo

---

## 9. Monitoramento e Alertas

### 9.1 Alertas Automáticos
- Legislações próximas do vencimento
- Mudanças em legislações associadas
- Inconsistências de conformidade
- Novas legislações relevantes

### 9.2 Métricas de Acompanhamento
- Taxa de conformidade por tipo de licença
- Tempo médio de atualização legislativa
- Número de associações por legislação
- Impacto de mudanças legislativas

---

## 10. Considerações de Performance

### 10.1 Otimizações
- Cache de legislações ativas por tipo
- Índices em campos de busca frequente
- Lazy loading de textos completos
- Compressão de metadados JSON

### 10.2 Escalabilidade
- Particionamento por data de vigência
- Arquivamento de legislações antigas
- Replicação de dados críticos
- Backup incremental de alterações

Este documento estabelece a base completa para a gestão de legislações no sistema de licenciamento, garantindo conformidade legal e rastreabilidade de todas as normas aplicáveis.