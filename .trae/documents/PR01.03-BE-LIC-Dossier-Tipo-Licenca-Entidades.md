# PR01.03-BE-LIC - Dossier Tipo de Licença - Entidades

## 1. Visão Geral

Este documento especifica a gestão das entidades envolvidas nos processos de licenciamento, incluindo órgãos públicos, instituições privadas e outras organizações que participam na análise, aprovação e fiscalização dos diferentes tipos de licença. Este módulo é fundamental para definir o fluxo institucional e as responsabilidades de cada entidade no processo de licenciamento.

**Módulo:** Dossier de Tipo de Licença - Entidades  
**Endpoint Base:** `/api/v1/entities` e `/api/v1/license-types/{id}/entities`  
**Versão:** 1.0  
**Data:** 2024

---

## 2. Estrutura do Módulo de Entidades

### 2.1 Entidade Organizacional

#### 2.1.1 Campos da Entidade
| Campo | Tipo | Validação | Descrição |
|-------|------|-----------|----------|
| id | String | Auto-gerado | Identificador único |
| name | String | 2-200 chars, NotBlank | Nome da entidade |
| acronym | String | 2-20 chars | Sigla ou acrônimo |
| type | String | NotBlank, Must exist in OPTIONS | Tipo de entidade |
| level | String | Must exist in OPTIONS | Nível administrativo |
| parentEntityId | String | Optional | Entidade superior |
| contactInfo | Object | Valid structure | Informações de contato |
| address | Object | Valid structure | Endereço completo |
| jurisdiction | String | Must exist in OPTIONS | Âmbito de jurisdição |
| status | String | NotBlank | Status da entidade |
| competencies | Array | Valid list | Competências da entidade |

#### 2.1.2 Estrutura do DTO de Entidade
```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@IgrpDTO
public class EntityRequestDTO {
    @NotNull(message = "Nome é obrigatório")
    @NotBlank(message = "Nome não pode estar vazio")
    @Size(min = 2, max = 200, message = "Nome deve ter entre 2 e 200 caracteres")
    private String name;
    
    @Size(min = 2, max = 20, message = "Sigla deve ter entre 2 e 20 caracteres")
    private String acronym;
    
    @NotNull(message = "Tipo é obrigatório")
    @NotBlank(message = "Tipo não pode estar vazio")
    private String typeKey;  // Referência para OPTIONS com ccode="ENTITY_TYPE"
    
    @NotNull(message = "Nível é obrigatório")
    @NotBlank(message = "Nível não pode estar vazio")
    private String levelKey;  // Referência para OPTIONS com ccode="ENTITY_LEVEL"
    
    private String parentEntityId;
    
    @Valid
    private ContactInfoDTO contactInfo;
    
    @Valid
    private AddressDTO address;
    
    private String jurisdictionKey;  // Referência para OPTIONS com ccode="JURISDICTION"
    
    @NotNull(message = "Status é obrigatório")
    @NotBlank(message = "Status não pode estar vazio")
    private String statusKey;  // Referência para OPTIONS com ccode="ENTITY_STATUS"
    
    private List<String> competencyKeys;  // Referências para OPTIONS com ccode="COMPETENCY"
    
    private Object metadata;
}

@Data
@NoArgsConstructor
@AllArgsConstructor
public class ContactInfoDTO {
    @Email(message = "Email deve ser válido")
    private String email;
    
    @Pattern(regexp = "^\\+?[0-9\\s\\-\\(\\)]+$", message = "Telefone deve ter formato válido")
    private String phone;
    
    @Pattern(regexp = "^\\+?[0-9\\s\\-\\(\\)]+$", message = "Fax deve ter formato válido")
    private String fax;
    
    @URL(message = "Website deve ser uma URL válida")
    private String website;
    
    private String contactPerson;
    
    private String department;
}

@Data
@NoArgsConstructor
@AllArgsConstructor
public class AddressDTO {
    @NotBlank(message = "Rua é obrigatória")
    private String street;
    
    private String number;
    
    private String complement;
    
    @NotBlank(message = "Cidade é obrigatória")
    private String city;
    
    private String district;
    
    @NotBlank(message = "Código postal é obrigatório")
    private String postalCode;
    
    @NotBlank(message = "País é obrigatório")
    private String country;
    
    private Double latitude;
    
    private Double longitude;
}
```

### 2.2 Associação Tipo de Licença - Entidade

#### 2.2.1 Campos da Associação
| Campo | Tipo | Validação | Descrição |
|-------|------|-----------|----------|
| licenseTypeId | String | NotBlank, Must exist | ID do tipo de licença |
| entityId | String | NotBlank, Must exist | ID da entidade |
| role | String | Must exist in OPTIONS | Papel da entidade |
| responsibility | String | Must exist in OPTIONS | Tipo de responsabilidade |
| isRequired | Boolean | NotNull | Se a participação é obrigatória |
| processingOrder | Integer | Min: 1 | Ordem no fluxo de processo |
| maxProcessingDays | Integer | Min: 1 | Prazo máximo para análise |
| canDelegate | Boolean | NotNull | Se pode delegar a análise |
| requiresPhysicalInspection | Boolean | NotNull | Se requer inspeção física |
| feeResponsible | Boolean | NotNull | Se é responsável por taxas |

#### 2.2.2 Estrutura do DTO de Associação
```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@IgrpDTO
public class LicenseTypeEntityRequestDTO {
    @NotNull(message = "ID da entidade é obrigatório")
    @NotBlank(message = "ID da entidade não pode estar vazio")
    private String entityId;
    
    @NotNull(message = "Papel é obrigatório")
    @NotBlank(message = "Papel não pode estar vazio")
    private String roleKey;  // ANALYZER, APPROVER, INSPECTOR, CONSULTANT
    
    @NotNull(message = "Responsabilidade é obrigatória")
    @NotBlank(message = "Responsabilidade não pode estar vazia")
    private String responsibilityKey;  // PRIMARY, SECONDARY, SUPPORT
    
    @NotNull(message = "Campo 'obrigatório' é obrigatório")
    private Boolean isRequired;
    
    @Min(value = 1, message = "Ordem de processamento deve ser pelo menos 1")
    private Integer processingOrder;
    
    @Min(value = 1, message = "Prazo máximo deve ser pelo menos 1 dia")
    private Integer maxProcessingDays;
    
    @NotNull(message = "Campo 'pode delegar' é obrigatório")
    private Boolean canDelegate;
    
    @NotNull(message = "Campo 'requer inspeção física' é obrigatório")
    private Boolean requiresPhysicalInspection;
    
    @NotNull(message = "Campo 'responsável por taxa' é obrigatório")
    private Boolean feeResponsible;
    
    private String delegationCriteria;
    
    private String inspectionScope;
    
    private Object metadata;
}
```

---

## 3. API REST - Gestão de Entidades

### 3.1 Operações CRUD de Entidades

#### 3.1.1 Listagem de Entidades
**Endpoint:** `GET /api/v1/entities`

**Parâmetros de Query:**
| Parâmetro | Tipo | Obrigatório | Padrão | Descrição |
|-----------|------|-------------|--------|-----------|
| type | string | Não | - | Tipo de entidade para filtrar |
| level | string | Não | - | Nível administrativo |
| jurisdiction | string | Não | - | Âmbito de jurisdição |
| status | string | Não | ACTIVE | Status da entidade |
| competency | string | Não | - | Competência específica |
| name | string | Não | - | Nome da entidade ou termo de busca |
| acronym | string | Não | - | Sigla da entidade |
| pageNumber | string | Não | "0" | Número da página |
| pageSize | string | Não | "20" | Tamanho da página |
| sort | string | Não | "name" | Campo de ordenação |
| direction | string | Não | "ASC" | Direção da ordenação (ASC/DESC) |

**Resposta de Sucesso (200):**
```json
{
  "pageNumber": 0,
  "pageSize": 20,
  "totalElements": 45,
  "totalPages": 3,
  "content": [
    {
      "id": "ent-001",
      "name": "Câmara Municipal da Praia",
      "acronym": "CMP",
      "typeKey": "MUNICIPAL",
      "typeName": "Câmara Municipal",
      "levelKey": "LOCAL",
      "levelName": "Local",
      "parentEntity": {
        "id": "ent-gov-cv",
        "name": "Governo de Cabo Verde",
        "acronym": "GOV-CV"
      },
      "contactInfo": {
        "email": "licenciamento@cmp.cv",
        "phone": "+238 260 89 00",
        "website": "https://www.cmp.cv",
        "contactPerson": "João Silva",
        "department": "Departamento de Licenciamento"
      },
      "address": {
        "street": "Avenida Cidade de Lisboa",
        "number": "1",
        "city": "Praia",
        "district": "Plateau",
        "postalCode": "7600",
        "country": "Cabo Verde"
      },
      "jurisdictionKey": "PRAIA",
      "jurisdictionName": "Município da Praia",
      "statusKey": "ACTIVE",
      "statusName": "Ativa",
      "competencies": [
        {
          "key": "COMMERCIAL_LICENSING",
          "name": "Licenciamento Comercial"
        },
        {
          "key": "URBAN_PLANNING",
          "name": "Planeamento Urbano"
        }
      ],
      "associatedLicenseTypes": 25,
      "metadata": {
        "establishedYear": 1975,
        "mayor": "Francisco Carvalho",
        "population": 159050,
        "area": "102.6 km²"
      }
    }
  ]
}
```

#### 3.1.2 Busca de Entidade por ID
**Endpoint:** `GET /api/v1/entities/{entitiyId}`

**Parâmetros de Path:**
| Parâmetro | Tipo | Descrição |
|-----------|------|-----------|
| entitiyId | string | ID único da entidade |

#### 3.1.3 Detalhes de Entidade
**Endpoint:** `GET /api/v1/entities/{entityId}`

**Resposta de Sucesso (200):**
```json
{
  "id": "ent-001",
  "name": "Câmara Municipal da Praia",
  "acronym": "CMP",
  "type": {
    "key": "MUNICIPAL",
    "name": "Câmara Municipal",
    "description": "Órgão de administração local municipal"
  },
  "level": {
    "key": "LOCAL",
    "name": "Local",
    "description": "Nível de administração local"
  },
  "hierarchy": {
    "parent": {
      "id": "ent-gov-cv",
      "name": "Governo de Cabo Verde",
      "level": "NATIONAL"
    },
    "children": [
      {
        "id": "ent-001-urb",
        "name": "Departamento de Urbanismo - CMP",
        "level": "DEPARTMENTAL"
      }
    ]
  },
  "contactInfo": {
    "email": "licenciamento@cmp.cv",
    "phone": "+238 260 89 00",
    "fax": "+238 260 89 01",
    "website": "https://www.cmp.cv",
    "contactPerson": "João Silva",
    "department": "Departamento de Licenciamento"
  },
  "address": {
    "street": "Avenida Cidade de Lisboa",
    "number": "1",
    "city": "Praia",
    "district": "Plateau",
    "postalCode": "7600",
    "country": "Cabo Verde",
    "latitude": 14.9177,
    "longitude": -23.5092
  },
  "jurisdiction": {
    "key": "PRAIA",
    "name": "Município da Praia",
    "coverage": "Municipal",
    "boundaries": {
      "north": 15.0000,
      "south": 14.8500,
      "east": -23.4000,
      "west": -23.6000
    }
  },
  "competencies": [
    {
      "key": "COMMERCIAL_LICENSING",
      "name": "Licenciamento Comercial",
      "description": "Análise e aprovação de licenças comerciais",
      "scope": "Municipal"
    },
    {
      "key": "URBAN_PLANNING",
      "name": "Planeamento Urbano",
      "description": "Análise de conformidade urbanística",
      "scope": "Municipal"
    }
  ],
  "operationalInfo": {
    "workingHours": {
      "weekdays": "08:00-16:00",
      "saturday": "08:00-12:00",
      "sunday": "Fechado"
    },
    "processingCapacity": {
      "dailyApplications": 50,
      "monthlyApplications": 1000,
      "averageProcessingDays": 15
    },
    "staff": {
      "totalEmployees": 25,
      "licensingOfficers": 8,
      "inspectors": 5
    }
  },
  "associatedLicenseTypes": [
    {
      "licenseTypeId": "lt-001",
      "licenseTypeName": "Licença de Restaurante",
      "role": "APPROVER",
      "responsibility": "PRIMARY"
    }
  ],
  "statistics": {
    "totalProcessedApplications": 2500,
    "averageProcessingTime": 12.5,
    "approvalRate": 85.2,
    "currentWorkload": 45
  },
  "metadata": {
    "establishedYear": 1975,
    "mayor": "Francisco Carvalho",
    "population": 159050,
    "area": "102.6 km²",
    "budget": 2500000000.00,
    "lastAudit": "2023-12-15"
  }
}
```

#### 3.1.4 Atualização de Entidade
**Endpoint:** `PUT /api/v1/entities/{entitiyId}`

**Parâmetros de Path:**
| Parâmetro | Tipo | Descrição |
|-----------|------|-----------|
| entitiyId | string | ID único da entidade |

**Payload de Requisição:** (mesmo formato da criação)

**Códigos de Status:**
- 200: Entidade atualizada com sucesso
- 400: Dados inválidos
- 404: Entidade não encontrada
- 409: Nome ou acrônimo já existe
- 500: Erro interno do servidor

#### 3.1.5 Ativação de Entidade
**Endpoint:** `PATCH /api/v1/entities/{entitiyId}/activate`

**Parâmetros de Path:**
| Parâmetro | Tipo | Descrição |
|-----------|------|-----------|
| entitiyId | string | ID único da entidade |

**Resposta de Sucesso (200):**
```json
{
  "message": "Entidade ativada com sucesso",
  "entityId": "ent-001",
  "status": "ACTIVE"
}
```

#### 3.1.6 Criação de Entidade
**Endpoint:** `POST /api/v1/entities`

**Payload de Requisição:**
```json
{
  "name": "Inspeção Geral das Atividades Económicas",
  "acronym": "IGAE",
  "typeKey": "INSPECTION_AGENCY",
  "levelKey": "NATIONAL",
  "parentEntityId": "ent-gov-cv",
  "contactInfo": {
    "email": "info@igae.gov.cv",
    "phone": "+238 260 12 00",
    "website": "https://www.igae.gov.cv",
    "contactPerson": "Maria Santos",
    "department": "Departamento de Licenciamento"
  },
  "address": {
    "street": "Avenida Combatentes da Liberdade da Pátria",
    "number": "45",
    "city": "Praia",
    "district": "Plateau",
    "postalCode": "7600",
    "country": "Cabo Verde"
  },
  "jurisdictionKey": "NATIONAL",
  "statusKey": "ACTIVE",
  "competencyKeys": [
    "ECONOMIC_INSPECTION",
    "COMPLIANCE_MONITORING",
    "LICENSING_OVERSIGHT"
  ],
  "metadata": {
    "establishedYear": 2010,
    "director": "Carlos Mendes",
    "inspectorCount": 15,
    "regionalOffices": 4
  }
}
```

---

## 4. API REST - Associações Tipo de Licença - Entidade

### 4.1 Gestão de Associações

#### 4.1.1 Listar Entidades de um Tipo de Licença
**Endpoint:** `GET /api/v1/license-types/{licenseTypeId}/entities`

**Parâmetros de Query:**
```
?role=APPROVER
&responsibility=PRIMARY
&required=true
&processingOrder=1
&active=true
```

**Resposta de Sucesso (200):**
```json
{
  "licenseTypeId": "lt-001",
  "licenseTypeName": "Licença de Restaurante",
  "totalEntities": 5,
  "requiredEntities": 3,
  "optionalEntities": 2,
  "estimatedTotalProcessingDays": 30,
  "entities": [
    {
      "associationId": "lte-001",
      "entity": {
        "id": "ent-001",
        "name": "Câmara Municipal da Praia",
        "acronym": "CMP",
        "type": "MUNICIPAL",
        "level": "LOCAL"
      },
      "role": {
        "key": "APPROVER",
        "name": "Aprovador",
        "description": "Entidade responsável pela aprovação final"
      },
      "responsibility": {
        "key": "PRIMARY",
        "name": "Primária",
        "description": "Responsabilidade principal no processo"
      },
      "isRequired": true,
      "processingOrder": 1,
      "maxProcessingDays": 15,
      "canDelegate": false,
      "requiresPhysicalInspection": true,
      "feeResponsible": true,
      "delegationCriteria": null,
      "inspectionScope": "Conformidade urbanística e segurança",
      "currentWorkload": {
        "pendingApplications": 25,
        "averageProcessingTime": 12,
        "capacity": "NORMAL"
      }
    },
    {
      "associationId": "lte-002",
      "entity": {
        "id": "ent-002",
        "name": "Delegacia de Saúde da Praia",
        "acronym": "DSP",
        "type": "HEALTH_AUTHORITY",
        "level": "LOCAL"
      },
      "role": {
        "key": "INSPECTOR",
        "name": "Inspetor",
        "description": "Entidade responsável pela inspeção técnica"
      },
      "responsibility": {
        "key": "SECONDARY",
        "name": "Secundária",
        "description": "Responsabilidade de apoio especializado"
      },
      "isRequired": true,
      "processingOrder": 2,
      "maxProcessingDays": 10,
      "canDelegate": true,
      "requiresPhysicalInspection": true,
      "feeResponsible": false,
      "delegationCriteria": "Pode delegar para técnicos certificados",
      "inspectionScope": "Segurança alimentar e condições sanitárias",
      "specialRequirements": [
        "Certificação HACCP",
        "Análise microbiológica",
        "Verificação de equipamentos"
      ]
    }
  ],
  "processFlow": {
    "sequential": true,
    "parallelSteps": [],
    "criticalPath": [
      "CMP - Análise urbanística",
      "DSP - Inspeção sanitária",
      "CMP - Aprovação final"
    ]
  }
}
```

#### 4.1.2 Associar Entidade a Tipo de Licença
**Endpoint:** `POST /api/v1/license-types/{licenseTypeId}/entities`

**Payload de Requisição:**
```json
{
  "entityId": "ent-003",
  "roleKey": "CONSULTANT",
  "responsibilityKey": "SUPPORT",
  "isRequired": false,
  "processingOrder": 3,
  "maxProcessingDays": 5,
  "canDelegate": true,
  "requiresPhysicalInspection": false,
  "feeResponsible": false,
  "delegationCriteria": "Pode delegar para consultores externos certificados",
  "inspectionScope": "Análise de impacto ambiental quando aplicável",
  "metadata": {
    "consultationTriggers": [
      "Capacidade > 100 pessoas",
      "Localização em zona sensível",
      "Atividade com impacto ambiental"
    ],
    "requiredCertifications": [
      "Avaliação Ambiental"
    ]
  }
}
```

**Resposta de Sucesso (201):**
```json
{
  "associationId": "lte-025",
  "message": "Entidade associada com sucesso",
  "licenseTypeId": "lt-001",
  "entityId": "ent-003",
  "role": "CONSULTANT",
  "responsibility": "SUPPORT",
  "processingOrder": 3,
  "estimatedImpact": {
    "additionalProcessingDays": 5,
    "newTotalProcessingDays": 35,
    "affectedApplications": 0
  }
}
```

#### 4.1.3 Fluxo de Processo por Entidades
**Endpoint:** `GET /api/v1/license-types/{licenseTypeId}/entities/process-flow`

**Resposta de Sucesso (200):**
```json
{
  "licenseTypeId": "lt-001",
  "licenseTypeName": "Licença de Restaurante",
  "processFlow": {
    "type": "SEQUENTIAL_WITH_PARALLEL",
    "totalSteps": 5,
    "estimatedDuration": 30,
    "criticalPath": 25,
    "steps": [
      {
        "stepNumber": 1,
        "type": "PARALLEL",
        "description": "Análises técnicas iniciais",
        "entities": [
          {
            "entityId": "ent-001",
            "name": "Câmara Municipal da Praia",
            "role": "ANALYZER",
            "task": "Análise urbanística",
            "maxDays": 10,
            "dependencies": []
          },
          {
            "entityId": "ent-004",
            "name": "Bombeiros da Praia",
            "role": "INSPECTOR",
            "task": "Análise de segurança contra incêndios",
            "maxDays": 7,
            "dependencies": []
          }
        ]
      },
      {
        "stepNumber": 2,
        "type": "SEQUENTIAL",
        "description": "Inspeção sanitária",
        "entities": [
          {
            "entityId": "ent-002",
            "name": "Delegacia de Saúde da Praia",
            "role": "INSPECTOR",
            "task": "Inspeção de condições sanitárias",
            "maxDays": 10,
            "dependencies": ["step-1"]
          }
        ]
      },
      {
        "stepNumber": 3,
        "type": "CONDITIONAL",
        "description": "Consulta ambiental (se aplicável)",
        "condition": "Capacidade > 100 pessoas OR Zona sensível",
        "entities": [
          {
            "entityId": "ent-003",
            "name": "Direção Nacional do Ambiente",
            "role": "CONSULTANT",
            "task": "Avaliação de impacto ambiental",
            "maxDays": 15,
            "dependencies": ["step-1", "step-2"]
          }
        ]
      },
      {
        "stepNumber": 4,
        "type": "SEQUENTIAL",
        "description": "Aprovação final",
        "entities": [
          {
            "entityId": "ent-001",
            "name": "Câmara Municipal da Praia",
            "role": "APPROVER",
            "task": "Decisão final de licenciamento",
            "maxDays": 5,
            "dependencies": ["step-1", "step-2", "step-3"]
          }
        ]
      }
    ]
  },
  "alternativeFlows": [
    {
      "condition": "Estabelecimento < 50m²",
      "description": "Fluxo simplificado",
      "skipSteps": [3],
      "estimatedDuration": 20
    }
  ]
}
```

---

## 5. Funcionalidades Avançadas

### 5.1 Análise de Capacidade

#### 5.1.1 Capacidade de Processamento por Entidade
**Endpoint:** `GET /api/v1/entities/{entityId}/capacity-analysis`

**Resposta de Sucesso (200):**
```json
{
  "entityId": "ent-001",
  "entityName": "Câmara Municipal da Praia",
  "currentCapacity": {
    "status": "NORMAL",
    "utilizationRate": 75.5,
    "pendingApplications": 45,
    "maxCapacity": 60,
    "availableSlots": 15
  },
  "processingMetrics": {
    "averageProcessingTime": 12.5,
    "targetProcessingTime": 15.0,
    "performanceRating": "GOOD",
    "bottlenecks": [
      "Inspeções físicas durante período de férias"
    ]
  },
  "workloadForecast": {
    "next7Days": {
      "expectedApplications": 12,
      "expectedCompletions": 15,
      "projectedUtilization": 70.0
    },
    "next30Days": {
      "expectedApplications": 50,
      "expectedCompletions": 55,
      "projectedUtilization": 72.0
    }
  },
  "recommendations": [
    "Considerar redistribuição de inspeções para períodos de menor demanda",
    "Avaliar possibilidade de delegação para reduzir carga de trabalho"
  ]
}
```

### 5.2 Otimização de Fluxos

#### 5.2.1 Análise de Otimização de Processo
**Endpoint:** `GET /api/v1/license-types/{licenseTypeId}/entities/optimization-analysis`

**Resposta de Sucesso (200):**
```json
{
  "licenseTypeId": "lt-001",
  "currentFlow": {
    "totalDuration": 30,
    "criticalPath": 25,
    "bottlenecks": [
      {
        "entityId": "ent-002",
        "entityName": "Delegacia de Saúde",
        "issue": "Inspeções físicas demoradas",
        "impact": 5
      }
    ]
  },
  "optimizationSuggestions": [
    {
      "type": "PARALLELIZATION",
      "description": "Executar análise urbanística e sanitária em paralelo",
      "potentialSaving": 7,
      "feasibility": "HIGH",
      "requirements": [
        "Coordenação entre CMP e DSP",
        "Protocolo de compartilhamento de informações"
      ]
    },
    {
      "type": "DELEGATION",
      "description": "Delegar inspeções simples para técnicos certificados",
      "potentialSaving": 3,
      "feasibility": "MEDIUM",
      "requirements": [
        "Certificação de técnicos externos",
        "Protocolo de supervisão"
      ]
    }
  ],
  "optimizedFlow": {
    "estimatedDuration": 20,
    "improvementPercentage": 33.3,
    "riskFactors": [
      "Necessidade de coordenação adicional",
      "Possível redução na qualidade da análise"
    ]
  }
}
```

---

## 6. Regras de Negócio Específicas

### 6.1 Validações de Associação

#### 6.1.1 Regras de Integridade
```java
// Validação de ordem de processamento
@AssertTrue(message = "Ordem de processamento deve ser única por tipo de licença")
public boolean isProcessingOrderUnique() {
    // Implementação da validação
    return true;
}

// Validação de responsabilidade primária
@AssertTrue(message = "Deve haver pelo menos uma entidade com responsabilidade primária")
public boolean hasPrimaryResponsibility() {
    // Implementação da validação
    return true;
}

// Validação de papel vs responsabilidade
@AssertTrue(message = "Aprovadores devem ter responsabilidade primária ou secundária")
public boolean isApproverResponsibilityValid() {
    return !"APPROVER".equals(roleKey) || 
           ("PRIMARY".equals(responsibilityKey) || "SECONDARY".equals(responsibilityKey));
}
```

#### 6.1.2 Regras de Fluxo
- Entidades com `processingOrder` menor devem completar antes das posteriores
- Entidades com `isRequired=true` não podem ser removidas se houver processos ativos
- Alterações em `maxProcessingDays` afetam apenas novos processos
- Delegação só é permitida se `canDelegate=true` e existirem critérios definidos

### 6.2 Regras de Jurisdição

#### 6.2.1 Validação de Competência Territorial
- Entidades só podem processar licenças dentro de sua jurisdição
- Entidades nacionais podem processar qualquer licença
- Entidades locais só processam licenças de sua área
- Conflitos de jurisdição devem ser resolvidos por entidade superior

#### 6.2.2 Hierarquia de Entidades
- Entidades filhas herdam competências da entidade pai
- Delegação deve respeitar a hierarquia organizacional
- Supervisão é exercida pela entidade imediatamente superior

---

## 7. Casos de Uso Específicos

### 7.1 UC001 - Configurar Fluxo Multi-Entidade
**Cenário:** Restaurante em zona turística (múltiplas aprovações)

**Entidades Envolvidas:**
1. Câmara Municipal (Aprovação urbanística)
2. Delegacia de Saúde (Inspeção sanitária)
3. Direção de Turismo (Conformidade turística)
4. Bombeiros (Segurança contra incêndios)
5. Polícia Nacional (Segurança pública)

**Fluxo:**
- Paralelo: CMP + Bombeiros + Polícia
- Sequencial: Delegacia de Saúde
- Condicional: Direção de Turismo (se zona turística)
- Final: CMP (Aprovação final)

### 7.2 UC002 - Delegação de Competências
**Cenário:** Sobrecarga na Delegacia de Saúde

**Fluxo:**
1. Identificar sobrecarga (>90% capacidade)
2. Verificar critérios de delegação
3. Selecionar técnicos certificados
4. Delegar inspeções simples
5. Manter supervisão da DSP

### 7.3 UC003 - Otimização de Processo
**Cenário:** Reduzir tempo de processamento

**Análise:**
1. Identificar gargalos no fluxo atual
2. Avaliar possibilidades de paralelização
3. Considerar delegação de tarefas
4. Implementar melhorias graduais
5. Monitorar impacto nas métricas

---

## 8. Integrações e Dependências

### 8.1 Sistemas Externos
- **Sistema de Gestão Documental**: Para troca de documentos
- **Sistema de Notificações**: Para comunicação entre entidades
- **Sistema de Geolocalização**: Para validação de jurisdição
- **Sistema de Agenda**: Para agendamento de inspeções

### 8.2 Módulos Internos
- **Tipos de Licença**: Definição de fluxos
- **Processos**: Execução dos fluxos
- **Solicitações**: Roteamento por entidade
- **Taxas**: Distribuição de receitas
- **Relatórios**: Análise de performance

---

## 9. Monitoramento e Métricas

### 9.1 KPIs por Entidade
- Tempo médio de processamento
- Taxa de aprovação/rejeição
- Capacidade de processamento
- Qualidade das análises
- Satisfação dos requerentes

### 9.2 Alertas Automáticos
- Sobrecarga de capacidade (>85%)
- Atrasos em processamento
- Inconsistências entre entidades
- Falhas de comunicação
- Violações de SLA

---

## 10. Considerações de Segurança

### 10.1 Controle de Acesso
- Autenticação por entidade
- Autorização baseada em competências
- Auditoria de todas as ações
- Segregação de dados por jurisdição

### 10.2 Proteção de Dados
- Criptografia de comunicações
- Backup de dados críticos
- Controle de versões de documentos
- Logs de auditoria imutáveis

Este documento estabelece a base completa para a gestão de entidades no sistema de licenciamento, garantindo coordenação eficiente e transparência nos processos multi-institucionais.